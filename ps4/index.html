<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="shortcut icon" href="http://mikuscallion.github.io/miku-ssn4.1_static/imgs/favicon.ico">
    <title>湿湿娘V4 PS4</title>
    <style>
        html,body{
            margin: 0px;
            height: 0px;
            height: 100%;
        }
    </style>
    <style>
        #ssn-ps4 {
  height: 100%; }
  #ssn-ps4 .head {
    height: 40px;
    background-color: #181F24;
    font-size: 20px;
    font-weight: bolder;
    color: white;
    text-align: center;
    line-height: 40px; }
  #ssn-ps4 .contain {
    height: calc(100% - 40px); }
    #ssn-ps4 .contain .video-wrap {
      width: 70%;
      float: left;
      height: 100%;
      padding: 5px;
      box-sizing: border-box;
      background-color: #181F24; }
      #ssn-ps4 .contain .video-wrap .video {
        width: 100%;
        height: 100%;
        background-color: black; }
    #ssn-ps4 .contain .list {
      display: inline-block;
      width: 30%;
      height: 100%;
      position: relative;
      background-color: #181F24;
      padding-top: 5px;
      padding-bottom: 5px;
      box-sizing: border-box; }
      #ssn-ps4 .contain .list .iscroll {
        height: 100%;
        overflow: hidden; }
        #ssn-ps4 .contain .list .iscroll .content .item {
          cursor: pointer;
          box-sizing: border-box;
          padding: 5px;
          height: 110px; }
          #ssn-ps4 .contain .list .iscroll .content .item .cover {
            height: 100px;
            width: 130px;
            display: inline-block;
            float: left;
            background-image: url(http://placehold.it/130x100); }
          #ssn-ps4 .contain .list .iscroll .content .item .info {
            display: inline-block;
            width: calc(100% - 130px);
            height: 100%;
            text-align: center;
            color: #8ca1af; }
            #ssn-ps4 .contain .list .iscroll .content .item .info .title {
              font-size: 16px;
              margin-bottom: 8px; }
            #ssn-ps4 .contain .list .iscroll .content .item .info .author {
              font-size: 14px; }
        #ssn-ps4 .contain .list .iscroll .content .item.active {
          background-color: #4D5D6E; }
          #ssn-ps4 .contain .list .iscroll .content .item.active .info {
            color: white; }
        #ssn-ps4 .contain .list .iscroll .content .item:hover {
          background-color: rgba(77, 93, 110, 0.3); }
        #ssn-ps4 .contain .list .iscroll .load-info {
          width: 100%;
          text-align: center;
          height: 30px;
          line-height: 30px;
          text-align: center;
          color: #8ca1af;
          font-size: 12px; }
  @media (max-width: 991px) {
    #ssn-ps4 .contain {
      display: block; }
      #ssn-ps4 .contain .video-wrap {
        width: 100%;
        height: 40%; }
      #ssn-ps4 .contain .list {
        width: 100%;
        height: 60%; } }

/*# sourceMappingURL=index.css.map */
    </style>
    <link rel="stylesheet" href="index.css">
    <!--百度统计代码，2016.02.20-->
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?a89940f2181ca765cdb12402a0829c11";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
</head>
<body>
    <div id="ssn-ps4">
        <div class="head">
            <div>shi-shi.net PS4</div>
        </div>
        <div class="contain">
            <div class="video-wrap">
                <video class="video" controls loop poster="http://mikuscallion.github.io/miku-ssn4.1_static/imgs/banner.jpg"></video>
            </div>
            <div class="list">
                <div class="iscroll">
                    <div>
                    <div class="content">
    <!--
                        <div class="item active">
                            <img class="cover" src="http://125.211.202.141:8023/?cmd=file&name=sm28197922.jpg"/>
                            <div class="info">
                                <div class="title">【結月ゆかり】 アスノヨゾラ哨戒班 【カバー】</div>
                                <div class="author">ダブルレン</div>
                            </div>
                        </div>
    -->
                    </div>
                    <!--滚动到底部自动看到这个，然后又消失，完美-->
                    <div class="load-info">...loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="http://cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/iScroll/5.1.3/iscroll.min.js"></script>
    <script>
        $(function(){
            var apibase = "http://125.211.202.141:8023/";
            var filebase = "http://125.211.202.141:8023/?cmd=file&name=";
            var dataparms = {cmd: "list", page: 1, item: 20, by: "download", order: "down"};
            
            var $listContent = $("#ssn-ps4 .list .content");
            var $video = $("#ssn-ps4 .video");
            
            var iscrollList = null;
            //init
            (function(){
                loadssnplaylist(dataparms);
                iscrollList = new IScroll("#ssn-ps4 .list .iscroll",{
                    //支持鼠标与点击
                    mouseWheel: true, click: true
                });
                iscrollList.on("scrollEnd",function(){
                    var needLoadOffset = 100;
                    if(Math.abs(this.y) > Math.abs(this.maxScrollY)-needLoadOffset){
                        //console.log("need load");
                        dataparms.page++;
                        loadssnplaylist(dataparms);
                    }
                });
            })();
            
            $listContent.delegate(".item","click", function(event) {
                var title = $(this).find(".title").text();
                var img = $(this).find(".cover").attr("src");
                var src = img.replace(".jpg",".mp4");
                //移除兄弟item active
                $(this).siblings().removeClass("active");
                $(this).addClass("active");
                
                $video.attr({"title":title,"poster":img,"src":src});
                $video[0].play();
            });
            function loadssnplaylist(parms){
                $.getJSON(apibase,parms,function(data){
                    var doms = toDoms(data);
                    $listContent.append(doms);
                    //在dom渲染完成后才能正确计算大小
                    iscrollList.refresh();
                });
                function toDoms(data){
                    if(!data.STATUS == "[I]OK"){
                        return [];
                    }
                    var doms = [];
                    for(var i=0;i<data.COUNTPERPAGE;i++){
                        var song = data[i];
                        var cover = filebase+song.ID+".jpg";
                        var title = song.TITLE;
                        var author = song.AUTHOR;
                        
                        var $dom = $("<div class='item'>\
                                            <img class='cover' src="+cover+" />\
                                            <div class='info'>\
                                                <div class='title'>"+title+"</div>\
                                                <div class='author'>"+author+"</div>\
                                            </div>\
                                        </div>");
                        doms.push($dom);
                    }
                    return doms;
                }
            }
        });
    </script>
</body>
</html>