<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <title>shi-shi player</title>
</head>
<body>
    <div class="container-fluid">
        <h1 class="page-header">湿湿播放器<small> | shi-shi player</small></h1>
        <div class="row">
            <div class="col-xs-12">
                <div id="shi-shi_player">
                    <span>湿湿播放器正在努力加载中 ...</span>
                </div>
            </div>
        </div>
    </div>
    <script src="http://cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>
    <script src="jwplayer/jwplayer.js"></script>
    <script>/*免费版key，6*/jwplayer.key = 'ykJW0P/zCddxjKqCieAWuZFn0JNryFJPivZg8Q==';</script>
    <script>
        $(function(){
            var apibase = "http://125.211.202.141:8023/";
            var dataparms = {cmd: "list", page: 1, item: 20, by: "download", order: "down"};
            (function init(){
                loadPlaylist(function(playlist){
                    //配置
                    jwplayer("shi-shi_player").setup({
                        width: '100%',
                        aspectratio: '16:9',//1080p
                        autostart: false,
                        mute: false,
                        repeat: true,
                        displaytitle: false,
                        playlist:playlist,
                        listbar: {
                            position: 'right',
                            size: '300'
                        }
                    });
                });
            })();
            
            function loadPlaylist(callback){
                $.getJSON(apibase,dataparms,function(data){
                    var playlist = toJwplayerPlaylist(data);
                    callback(playlist);
                    function toJwplayerPlaylist(data){
                        if(!(data.STATUS == "[I]OK")){
                            return [];
                        }
                        var playlist = [];
                        for(var i=0;i<data.COUNTPERPAGE;i++){
                            var item = data[i];
                            item.file = apibase+"MP4/"+item.ID+".mp4";
                            item.image = apibase+"IMG/"+item.ID+".jpg";
                            item.title = item.TITLE;
                            item.description = item.AUTHOR;
                            playlist.push(item);
                        }
                        return playlist;
                    }
                });
            }
        });
    </script>
</body>
</html>